#!/bin/sh -e
# vi: foldmethod=marker
### Here are some observations about the data gathered from shader_test. 
### Think of this kinda like a jupyter notebook. The format goes:
#
#{{{ Section start
### Command
#code
# OUTPUT:
# the code's output
#}}} Section end

### XXX testing is new and incomplete, take everything with a grain of salt

### XXX test on different noise levels
### XXX test temporal (including ME)

#{{{ Optimal non-local means 2x upscale (luma)
#
#fn='max=S:10.218485798609118:1.01_cfgopts=CFG_SIZE="2*":SF=2:PS=0:R=7:RS=8:SK="sphinx":SS=1.369:SW="EPSILON":WD=0:RF_LUMA="2*":RI=0,7:RF=0_corruption=VF=scale=540:540_media=images.stats.bz2'
#bzcat "stats/$fn" | sort -k 2 -n | tail
#
# OUTPUT:
# BASELINE=VF=scale=540:540 0.927599
# S=13.772975:CFG_SIZE=2*:SF=2:PS=0:R=7:RS=8:SK=sphinx:SS=1.369000:SW=EPSILON:WD=0:RF_LUMA=2*:RI=0:RF=0 0.935378
# S=13.266202730959009:CFG_SIZE=2*:SF=2:PS=0:R=7:RS=8:SK=sphinx:SS=1.369000:SW=EPSILON:WD=0:RF_LUMA=2*:RI=7:RF=0 0.9354356
#
#}}}

#{{{ Optimal non-local means (luma, P=3:R=5:PS=3:RS=3)
#
### Slight regression since optimizing the LQ NLM that is injected here, 
### but not big enough to be an issue and maybe not even big enough to 
### noteworthy.
#
#fn='max=S:2.2153675413022222:1.01,SW:0.4251181962477117:1.01,SS:0.4943277412779620897:1.01,WDT:0.3546631299901861:1.01_media=images.stats.bz2'
#bzcat "stats/$fn" | sort -k 2 -n | tail
#
# OUTPUT:
# S=2.1935417950125573:SW=0.4293906341200012:SS=0.48496771547578726:WDT=0.3513053819107378: 0.95759924
# S=2.1935417950125573:SW=0.4293906341200012:SS=0.48702258423476513:WDT=0.35822749444658747: 0.95759924
# S=2.1935417950125573:SW=0.4426478841741005:SS=0.4845875318870328:WDT=0.35822749444658747: 0.95759924
# S=2.1935417950125573:SW=0.4251181962477117:SS=0.48702258423476513:WDT=0.35822749444658747: 0.95759938
# S=2.1935417950125573:SW=0.4336630719922907:SS=0.48496771547578726:WDT=0.3513053819107378: 0.95759938
# S=2.1935417950125573:SW=0.4209299422801698:SS=0.48702258423476513:WDT=0.35822749444658747: 0.9575994
# S=2.1935417950125573:SW=0.4293906341200012:SS=0.4845875318870328:WDT=0.35822749444658747: 0.9575994
# S=2.1935417950125573:SW=0.4251181962477117:SS=0.4894576365824974:WDT=0.3546631299901861: 0.95759944
# S=2.1935417950125573:SW=0.4336630719922907:SS=0.4845875318870328:WDT=0.35822749444658747: 0.95759952
# S=2.1935417950125573:SW=0.4251181962477117:SS=0.48964772837687465:WDT=0.3513053819107378: 0.95759954
#
#}}}

#{{{ Optimal non-local means (luma, P=3:R=5:PS=4:RS=3:WD=1:RI=0:RFI=0:RF_LUMA=0)
#
### Suprisingly this performs almost as well as regular NLM
#
#fn='max=S:2.19,SW:0.5,SS:0.46,WDT:0.42_cfgopts=PS=4:WD=1:RF=0:RF_LUMA=0:RI=0:RFI=0_media=images.stats.bz2'
#bzcat "stats/$fn" | sort -k 2 -n | tail
#
# OUTPUT:
# S=3.7301445:SW=0.746094:SS=0.524688:WDT=0.597188:PS=4:WD=1:RF=0:RF_LUMA=0:RI=0:RFI=0 0.9556144
# S=3.7301445:SW=0.78125:SS=0.524688:WDT=0.538125:PS=4:WD=1:RF=0:RF_LUMA=0:RI=0:RFI=0 0.95561448
# S=3.421875:SW=0.605469:SS=0.524688:WDT=0.479063:PS=4:WD=1:RF=0:RF_LUMA=0:RI=0:RFI=0 0.95561462
# S=3.7301445:SW=0.763672:SS=0.524688:WDT=0.626719:PS=4:WD=1:RF=0:RF_LUMA=0:RI=0:RFI=0 0.95561468
# S=3.7301445:SW=0.728516:SS=0.557031:WDT=0.538125:PS=4:WD=1:RF=0:RF_LUMA=0:RI=0:RFI=0 0.9556149
# S=3.421875:SW=0.623047:SS=0.524688:WDT=0.493828:PS=4:WD=1:RF=0:RF_LUMA=0:RI=0:RFI=0 0.95561502
# S=3.7301445:SW=0.710938:SS=0.557031:WDT=0.538125:PS=4:WD=1:RF=0:RF_LUMA=0:RI=0:RFI=0 0.9556155
# S=3.421875:SW=0.623047:SS=0.524688:WDT=0.479063:PS=4:WD=1:RF=0:RF_LUMA=0:RI=0:RFI=0 0.9556157
# S=3.7301445:SW=0.763672:SS=0.524688:WDT=0.611953:PS=4:WD=1:RF=0:RF_LUMA=0:RI=0:RFI=0 0.95561658
# S=3.7301445:SW=0.763672:SS=0.524688:WDT=0.597188:PS=4:WD=1:RF=0:RF_LUMA=0:RI=0:RFI=0 0.95561776
#
### WDP couldn't be optimized any further
#
#fn='max=S:3.7301445,WDP:6.0_cfgopts=SW=0.763672:SS=0.524688:WDT=0.597188:PS=4:WD=1:RF=0:RF_LUMA=0:RI=0:RFI=0_media=images.stats.bz2'
#bzcat "stats/$fn" | sort -k 2 -n | tail
#
# OUTPUT:
# BASELINE=NOISE=10:10 0.8704759
# S=3.7301445:WDP=3.84:SW=0.763672:SS=0.524688:WDT=0.597188:PS=4:WD=1:RF=0:RF_LUMA=0:RI=0:RFI=0 0.95557628
# S=3.6462162488:WDP=9.375:SW=0.763672:SS=0.524688:WDT=0.597188:PS=4:WD=1:RF=0:RF_LUMA=0:RI=0:RFI=0 0.95558454
# S=3.6462162488:WDP=7.6875:SW=0.763672:SS=0.524688:WDT=0.597188:PS=4:WD=1:RF=0:RF_LUMA=0:RI=0:RFI=0 0.95560154
# S=3.6462162488:WDP=6.84375:SW=0.763672:SS=0.524688:WDT=0.597188:PS=4:WD=1:RF=0:RF_LUMA=0:RI=0:RFI=0 0.95561
# S=3.7301445:WDP=4.92:SW=0.763672:SS=0.524688:WDT=0.597188:PS=4:WD=1:RF=0:RF_LUMA=0:RI=0:RFI=0 0.95561156
# S=3.6462162488:WDP=6.0:SW=0.763672:SS=0.524688:WDT=0.597188:PS=4:WD=1:RF=0:RF_LUMA=0:RI=0:RFI=0 0.95561288
# S=3.7301445:WDP=5.73:SW=0.763672:SS=0.524688:WDT=0.597188:PS=4:WD=1:RF=0:RF_LUMA=0:RI=0:RFI=0 0.95561346
# S=3.7301445:WDP=5.19:SW=0.763672:SS=0.524688:WDT=0.597188:PS=4:WD=1:RF=0:RF_LUMA=0:RI=0:RFI=0 0.95561396
# S=3.7301445:WDP=5.46:SW=0.763672:SS=0.524688:WDT=0.597188:PS=4:WD=1:RF=0:RF_LUMA=0:RI=0:RFI=0 0.95561434
#
#}}}

#{{{ Optimal non-local means (chroma, P=3:R=5:PS=3:RS=3:WD=1:RF=0)
#
#fn='max=S:3.0456682882195794,SW:0.2941943436614466,WDT:0.7141796663782247,SS:0.230696420626132_cfgopts=WD=1:RF=0_plane=CHROMA_media=images.stats.bz2'
#bzcat "stats/$fn" | sort -k 2 -n | tail
#
# OUTPUT:
# BASELINE=NOISE=10:10 0.72809122
# S=4.985978566558599:SW=0.7353169262213034:WDT=0.960341797329127:SS=0.23341241032450166:WD=1:RF=0 0.95788716
#
#}}}

#{{{ Optimal non-local means (chroma, P=3:R=5:PS=3:RS=3)
#
#fn='max=S:3.0456682882195794,SW:0.2941943436614466,WDT:0.7141796663782247,SS:0.230696420626132_cfgopts=RI=0,1,3:RFI=0,1,2_plane=CHROMA_media=images.stats.bz2'
#bzcat "stats/$fn" | sort -k 2 -n | tail
#
# OUTPUT:
# BASELINE=NOISE=10:10 0.72809122
# S=3.3658995317106006:SW=0.24480827657161897:WDT=0.635065162601492:SS=0.27606711054479316:RI=1:RFI=0 0.95830037
# S=3.360521150098731:SW=0.16369663533836373:WDT=0.6490633308641199:SS=0.28611504606422106:RI=1:RFI=2 0.95832748
# S=3.545162606405783:SW=0.26987804624049516:WDT=0.677523094101523:SS=0.27032890900017986:RI=1:RFI=1 0.95835569
# S=2.675504856826908:SW=0.24201072826727976:WDT=0.04222306322436812:SS=0.2625973807721007:RI=3:RFI=2 0.95840203
# S=3.2268476221581244:SW=0.1937346956177749:WDT=0.601877248923456:SS=0.2922295518055411:RI=3:RFI=1 0.95844897
# S=3.5022088496310104:SW=0.27334226402376255:WDT=0.6895408322989061:SS=0.26220719203759596:RI=3:RFI=0 0.95847136
# S=4.245145128111749:SW=0.30657919888021357:WDT=0.7739806663479871:SS=0.25469387777587865:RI=0:RFI=2 0.95854462
# S=3.974525895943187:SW=0.2623734386496335:WDT=0.7351998016701631:SS=0.27956983725349016:RI=0:RFI=1 0.95857148
# S=3.9856060408058616:SW=0.20101231681764717:WDT=0.7376637633530657:SS=0.27763977684848956:RI=0:RFI=0 0.95860436
#
#}}}

#{{{ Optimal NLM LGC (chroma, necessarily)
#
#fn="NLM:images:CHROMA:NOISE=10:10:1080x1080:yuv444p:CAT=1:MAX=S:10:3:1e-6:10:RF='SHARE_LUMA':D1W=1:RI=3:RFI=2:WDT=0.0,0.25...1.5:SW=1.0,0.875,0.75:R=3,5,7.stats.bz2"
#bzcat "stats/$fn" | sort -k 2 -n | tail
#
# OUTPUT:
# S=8.888889:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.750000:SW=0.750000:R=7 0.9465736909
# S=8.333333:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.250000:SW=1.000000:R=7 0.94704555455
# S=8.333333:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.000000:SW=1.000000:R=7 0.94706957273
# S=8.333333:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.500000:SW=1.000000:R=7 0.9471524091
# S=7.500000:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.250000:SW=0.875000:R=7 0.947231364
# S=7.222222:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.000000:SW=0.875000:R=7 0.947245964
# S=8.333333:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.500000:SW=0.875000:R=7 0.94735124545
# S=7.222222:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.250000:SW=0.750000:R=7 0.9473976909
# S=7.222222:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.000000:SW=0.750000:R=7 0.9474485909
# S=8.333333:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.500000:SW=0.750000:R=7 0.9475138727
#
#bzcat "stats/$fn" | grep -F :R=5 | sort -k 2 -n | tail
#
# OUTPUT:
# S=13.333333:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.250000:SW=1.000000:R=5 0.93730393636
# S=13.333333:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.000000:SW=1.000000:R=5 0.93733117273
# S=13.333333:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.500000:SW=0.875000:R=5 0.93767555455
# S=15.000000:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.750000:SW=0.875000:R=5 0.9376983
# S=12.222222:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.250000:SW=0.875000:R=5 0.93772519091
# S=12.777778:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.000000:SW=0.875000:R=5 0.9377606545
# S=12.500000:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.500000:SW=0.750000:R=5 0.9380457273
# S=15.000000:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.750000:SW=0.750000:R=5 0.9380642727
# S=11.666667:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.250000:SW=0.750000:R=5 0.93810337273
# S=11.666667:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.000000:SW=0.750000:R=5 0.938148545
#}}}

