#!/bin/sh -e
# vi: foldmethod=marker
### Here are some observations about the data gathered from shader_test. 
### Think of this kinda like a jupyter notebook. The format goes:
#
#{{{ Section start
### Command
#code
# OUTPUT:
# the code's output
#}}} Section end

### XXX testing is new and incomplete, take everything with a grain of salt

### XXX test on different noise levels
### XXX test temporal (including ME)

#{{{ Optimal non-local means 2x upscale (luma)
#
#fn='max=S:13.266202730959009,SW:1.0,SS:1.369_cfgopts=CFG_SIZE="2*":RF_LUMA="2*":RF=0:SF=2:PS=0:RI=7:R=7:RS=8:SK="sphinx","sphinx_":GUIDE_INPUT=0,1:WD=0_corruption=VF=scale=540:540_media=images.stats.bz2'
#bzcat "stats/$fn" | sort -k 2 -n | tail
#
# OUTPUT:
# S=11.390830281416473:SW=1.1622758820536392:SS=1.3743379711483994:CFG_SIZE=2*:RF_LUMA=2*:RF=0:SF=2:PS=0:RI=7:R=7:RS=8:SK=sphinx:GUIDE_INPUT=0:WD=0 0.9095094
# BASELINE=VF=scale=540:540 0.927599
# S=-3199.0714224371645:SW=-47.35517225503534:SS=-0.027989827472946066:CFG_SIZE=2*:RF_LUMA=2*:RF=0:SF=2:PS=0:RI=7:R=7:RS=8:SK=sphinx_:GUIDE_INPUT=1:WD=0 0.9317566
# S=1666.6372365833054:SW=-0.049555924747629:SS=-0.43743925288303753:CFG_SIZE=2*:RF_LUMA=2*:RF=0:SF=2:PS=0:RI=7:R=7:RS=8:SK=sphinx:GUIDE_INPUT=1:WD=0 0.9317566
# S=12.691082060658802:SW=0.8013639971832847:SS=1.3873631127950998:CFG_SIZE=2*:RF_LUMA=2*:RF=0:SF=2:PS=0:RI=7:R=7:RS=8:SK=sphinx_:GUIDE_INPUT=0:WD=0 0.9348456
#
#}}}

#{{{ Optimal non-local means (luma, P=3:R=5:PS=3:RS=3)
#
#fn='max=S:1.9497582289082855,SS:0.4414016342529828,SW:1.263006193657711,WDT:0.11220917255618369_media=images.stats.bz2'
#bzcat "stats/$fn" | sort -k 2 -n | tail
#
# OUTPUT:
# BASELINE=NOISE=10:10 0.8704759
# S=2.0522687499802097:SS=0.5296176863733414:SW=1.3011446081346498:WDT=0.11671341022864548: 0.95756232
#
#}}}

#{{{ Optimal non-local means (luma, P=3:R=5:PS=4:RS=3:WD=1:RI=0:RFI=0:RF_LUMA=0)
#
### Suprisingly this performs almost as well as regular NLM
#
#fn='max=S:3.7,SS:0.52,SW:0.76,WDT:0.59,WDP:5.46_cfgopts=PS=4:WD=1:RF=0:RF_LUMA=0:RI=0:RFI=0_media=images.stats.bz2'
#bzcat "stats/$fn" | sort -k 2 -n | tail
#
# OUTPUT:
# BASELINE=NOISE=10:10 0.8704759
# S=3.5968056672833097:SS=0.49764743714339127:SW=0.7392620481427672:WDT=0.580415381682815:WDP=5.381278367349288:PS=4:WD=1:RF=0:RF_LUMA=0:RI=0:RFI=0 0.95563478
#
#}}}

#{{{ Optimal non-local means (chroma, P=3:R=5:PS=3:RS=3:WD=1:RF=0)
#
#fn='max=S:4.98,SS:0.23,SW:0.735,WDT:0.96,WDP:5.381278367349288_cfgopts=WD=1:RF=0:RF_LUMA=0_plane=CHROMA_media=images.stats.bz2'
#bzcat "stats/$fn" | sort -k 2 -n | tail
#
# OUTPUT:
# BASELINE=NOISE=10:10 0.72809122
# S=5.191526541606411:SS=0.32091162692066677:SW=0.6448288408806067:WDT=0.913447511792627:WDP=5.832936323930807:WD=1:RF=0:RF_LUMA=0 0.95800093
#
#}}}

#{{{ Optimal non-local means (chroma, P=3:R=5:PS=3:RS=3)
#
#fn='max=S:3.9856060408058616,SW:0.20101231681764717,WDT:0.7376637633530657,SS:0.27763977684848956_plane=CHROMA_media=images.stats.bz2'
#bzcat "stats/$fn" | sort -k 2 -n | tail
#
# OUTPUT:
# BASELINE=NOISE=10:10 0.72809122
# S=2.5168955531436197:SW=1.2219854377433914:WDT=0.002713346103131793:SS=0.26295970436981203: 0.95837729
#
### WD can be disabled w/o much difference in quality
#
#fn='cfgopts=WD=0,1,2_plane=CHROMA_media=images.stats.bz2'
#bzcat "stats/$fn" | sort -k 2 -n | tail
#
# OUTPUT:
# BASELINE=NOISE=10:10 0.72809122
# WD=1 0.95836022
# WD=2 0.95836022
# WD=0 0.95836025
#
#}}}

#{{{ Optimal NLM LGC
#
#fn="NLM:images:CHROMA:NOISE=10:10:1080x1080:yuv444p:CAT=1:MAX=S:10:3:1e-6:10:RF='SHARE_LUMA':D1W=1:RI=3:RFI=2:WDT=0.0,0.25...1.5:SW=1.0,0.875,0.75:R=3,5,7.stats.bz2"
#bzcat "stats/$fn" | sort -k 2 -n | tail
#
# OUTPUT:
# S=8.888889:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.750000:SW=0.750000:R=7 0.9465736909
# S=8.333333:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.250000:SW=1.000000:R=7 0.94704555455
# S=8.333333:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.000000:SW=1.000000:R=7 0.94706957273
# S=8.333333:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.500000:SW=1.000000:R=7 0.9471524091
# S=7.500000:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.250000:SW=0.875000:R=7 0.947231364
# S=7.222222:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.000000:SW=0.875000:R=7 0.947245964
# S=8.333333:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.500000:SW=0.875000:R=7 0.94735124545
# S=7.222222:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.250000:SW=0.750000:R=7 0.9473976909
# S=7.222222:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.000000:SW=0.750000:R=7 0.9474485909
# S=8.333333:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.500000:SW=0.750000:R=7 0.9475138727
#
#bzcat "stats/$fn" | grep -F :R=5 | sort -k 2 -n | tail
#
# OUTPUT:
# S=13.333333:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.250000:SW=1.000000:R=5 0.93730393636
# S=13.333333:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.000000:SW=1.000000:R=5 0.93733117273
# S=13.333333:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.500000:SW=0.875000:R=5 0.93767555455
# S=15.000000:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.750000:SW=0.875000:R=5 0.9376983
# S=12.222222:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.250000:SW=0.875000:R=5 0.93772519091
# S=12.777778:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.000000:SW=0.875000:R=5 0.9377606545
# S=12.500000:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.500000:SW=0.750000:R=5 0.9380457273
# S=15.000000:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.750000:SW=0.750000:R=5 0.9380642727
# S=11.666667:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.250000:SW=0.750000:R=5 0.93810337273
# S=11.666667:RF=SHARE_LUMA:D1W=1:RI=3:RFI=2:WDT=0.000000:SW=0.750000:R=5 0.938148545
#}}}

